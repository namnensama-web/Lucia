<style>
  #dont-press-btn {
    position: fixed;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 999;
    background: rgba(50, 50, 50, 0.8);
    color: #fff;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 30px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    transition: background 0.3s;
  }
  #dont-press-btn:hover { background: rgba(80, 80, 80, 0.9); }

  #scare-popup {
    display: none;
    position: fixed;
    z-index: 1000;
    text-align: center;
  }

  #scare-popup img {
    max-width: 100%;
    height: auto;
    transition: all 0.4s ease-out;
  }

  .bubble {
    background: rgba(255, 255, 255, 0.9);
    color: #000;
    padding: 15px 30px;
    border-radius: 30px;
    margin-top: 20px;
    display: inline-block;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    font-size: 24px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.6s;
  }

  @keyframes jumpOutMild {
    0% { bottom: -300px; opacity: 0; transform: translateX(-50%) scale(0.5); }
    70% { bottom: 120px; transform: translateX(-50%) scale(1.1); }
    100% { bottom: 100px; opacity: 1; transform: translateX(-50%) scale(1); }
  }

  @keyframes jumpOutScary {
    0% { opacity: 0; transform: scale(0.8); }
    100% { opacity: 1; transform: scale(1); }
  }

  .dark #dont-press-btn { background: rgba(200, 200, 200, 0.2); color: #eee; }
  .dark .bubble { background: rgba(50, 50, 50, 0.9); color: #fff; }
</style>

<button id="dont-press-btn">千万不要按</button>

<div id="scare-popup">
  <img src="/images/cute-cat.png" alt="惊喜">
  <div class="bubble">喵呜！</div>
</div>

<audio id="sound1" src="/meow.mp3" preload="auto">
<audio id="sound2" src="/scream.mp3" preload="auto">

<script>
  const btn = document.getElementById('dont-press-btn');
  const popup = document.getElementById('scare-popup');
  const img = popup.querySelector('img');
  const bubble = popup.querySelector('.bubble');
  const sound1 = document.getElementById('sound1');
  const sound2 = document.getElementById('sound2');

  let clickCount = 0;
  let isClicking = false;

  btn.addEventListener('click', async function() {
    if (isClicking) return;
    isClicking = true;

    clickCount++;
    resetPopupStyle();

    if (clickCount === 1) {
      // 第一次：弹窗4秒后消失，立即解锁按钮
      img.src = '/images/cute-cat.png';
      popup.style.top = 'auto';
      popup.style.left = '50%';
      popup.style.width = 'auto';
      popup.style.height = 'auto';
      popup.style.bottom = '-300px';
      popup.style.transform = 'translateX(-50%)';
      popup.style.background = 'none';
      popup.style.animation = 'jumpOutMild 1s ease-out forwards';
      bubble.textContent = '喵呜！';
      bubble.style.fontSize = '24px';
      bubble.style.color = '#000';
      bubble.style.background = 'rgba(255, 255, 255, 0.9)';
      
      sound1.currentTime = 0;
      sound1.play();
      popup.style.display = 'block';
      setTimeout(() => { bubble.style.opacity = '1'; }, 800);

      // 第一次弹窗 4秒 后隐藏
      setTimeout(() => {
        hidePopup();
      }, 4000);

      // 立即解锁按钮，允许第二次点击
      setTimeout(() => {
        isClicking = false;
      }, 100);
    } else if (clickCount === 2) {
      // 第二次：音频立即，视觉延迟1.5秒
      sound2.currentTime = 0;
      sound2.play();

      setTimeout(() => {
        img.src = '/images/scary-ghost.png';
        popup.style.top = '0';
        popup.style.left = '0';
        popup.style.width = '100vw';
        popup.style.height = '100vh';
        popup.style.bottom = 'auto';
        popup.style.transform = 'none';
        popup.style.background = '#000';
        popup.style.animation = 'jumpOutScary 0.4s ease-out forwards';
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        bubble.textContent = '哇袄！！！';
        bubble.style.fontSize = '60px';
        bubble.style.color = '#f00';
        bubble.style.background = 'rgba(0, 0, 0, 0.8)';
        popup.style.display = 'block';
        setTimeout(() => { bubble.style.opacity = '1'; }, 400);
      }, 1500);

      setTimeout(() => {
        btn.style.display = 'none';
      }, 3500);

      setTimeout(() => {
        hidePopup();
        isClicking = false;
      }, 7000);
    } else {
      isClicking = false;
    }
  });

  function resetPopupStyle() {
    popup.style.display = 'none';
    popup.style.animation = '';
    popup.style.background = 'none';
    img.style.width = '';
    img.style.height = '';
    img.style.objectFit = '';
    bubble.style.opacity = '0';
  }

  function hidePopup() {
    popup.style.display = 'none';
    sound1.pause();
    sound2.pause();
  }
</script>
